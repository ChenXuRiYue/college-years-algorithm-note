#### problem

给定一个表达式 ， 建立一个表达式图。



#### code

```cpp
const int maxn = 1000;
int lch[maxn] , rch[maxn];char op[maxn];
int nc;

//返回建立的子表达式的树根
int build_tree(char* ss, int x, int y)
{
    int i, c1 = -1, c2 = -1 , p = 0;
    int u;
    if(y - x == 1){
        u = ++nc;
        lch[u] = rch[u] = 0; op[u] = s[x];
        return u;
    }
    
    for(int  i = x; i < y; i++){
        switch(s[i]){
            case '(': p++; break;
            case ')': p--; break;
            case '+': case '-': if(!p) c1 = i; break;
            case '*': case '/': if(!p) c2 = i; break;
        }
    }
    
    if(c1 < 0) c1 = c2;
    if(c1 < 0) return build_tree(s , x + 1 , y - 1);
    u = ++nc;
    lch[u] = build_tree(s, x, c1);
    rch[u] = build_tree(s, c1 + 1, y);
    op[u] = s[c1];
    return u;
}
```

##### 回顾tips

这个程序讨论了表达式子的特种情况。利用p，c1 ,c2收集了相关的信息。利用正确的方式处理了所有的情况。

- p: 遍历过程中。记录了2前面的阔后出现的情况。

- c1记录括号外的加减号的位置。
- c2记录括号外的乘除号的位置。

综上：思路就是寻找最后计算的运算符号。

如果有多个根据计算机程序计算的结合性就是计算最右边的符号。所以扫描了一遍就能满足了需求。

1. 实现能力：

在扫描过程中记录关键信息 ， 处理信息；就是扫描线思想。在扫描一遍的过程中，我可以什么信息处理。认识结构？

#### 例题

公共表达式消除

该问题的解决涉及了树哈希，以及表达式建树等问题。

这里主要解决公共表达式建树问题：

