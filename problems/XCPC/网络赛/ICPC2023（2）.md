# CCPC网络赛

[PTA | 程序设计类实验辅助教学平台 (pintia.cn)](https://pintia.cn/problem-sets/1705510247604809728/exam/problems/1705514248467492872?type=7&page=0)

我与期望相关的贪心不公待天！！

## **I Impatient Patient**

You accidentally sprained your ankle, and now you are facing a long recovery phase. Initially, you are at stage 0, and your recovery progresses until you reach stage *n*.

Each day, if you rest properly, you advance by exactly one stage. So it takes *n* days for you to recover, that is, if you do not do anything improper.

However, instead of resting, you have the option to challenge yourself, which also takes one day. If you are at stage *i* and succeed, you will instantly recover. However, if you fail, you will regress to stage *$a_i$* (0≤*$a_i$*≤*i*). The probability of success is *$p_i$*.

Now, you are wondering what the expected time required for your recovery would be, assuming you adopt the best strategy.

### Input

The first line contains a positive integer *T* (1≤*T*≤104), denoting the number of test cases.

For each test case:

- The first line contains one integer *n* ($1≤n≤5×10^5$), denoting the number of stages of recovery.
- The next line contains *n* integers $a_0,a_1,⋯,a_{n−1} (0≤a_i≤i)$, denoting the stage you will go back to if you fail at stage *i*.
- The next line contains *n* integers$q_0,q_1,⋯,q_{n−1} (0≤q_i≤10^5)$, where $p_i=q_i/10^5 $denotes the probability of success at stage *i*.

It is guaranteed that $∑n≤5×10^5$

### solve

发现最优策略必然是一下这种形式：

不断的选择走到某个点，在这个点上一直赌，赌输了回到这个点继续赌。于是就变成了一个明确过程，计算期望的问题。

**证明如下：**

$f_i$ 表示第一次在i点赌的，后续过程的最小步数期望。

$g_i$ 表示第一次在i点赌的，总体上的方案最小期望。$g_i = i + f_i$

![null (4)](null%20(4).png)

**求解$g_i$ **
$$
g_i = i +  \sum_{k = 0} ^{+oo} (1 + k\times(i - a_i + 1))(\overline p )^k p\\
=i  + p\sum _{k = 0}^{+oo} (1 + k\times (i - a_i + 1)) (\overline p) ^k\\
令D = i- a_i  + 1 ，原式：\\
= i+ p\sum _{k = 0}^{+oo} (1 + k\times D) (\overline p) ^k\\
= i + 1 + D\times (\frac{\overline p}{p})
$$

### 生长思考：

1. 首先1000个人过的题，为什么不是一个朴素结论的题？
   1. 为什么长时间以来，都不去考虑是否可能拥有一个朴素的结论？

2. 



### code

```cpp
const int inf = 1E9 + 7;
const ll INF = 1E18 + 7;
const int N = 1E6 + 10;
void work(int testNo)
{
	int n; cin >> n;
	vector<int> b(n) , a(n);
	for (int i = 0; i < n; i++) {
		cin >> a[i];
	}
	for (int i = 0; i < n; i++) {
		cin >> b[i];
	}
	long double ans = n;
	for (int i = 0; i < n; i++) {
		if (b[i] == 0) continue;
		long double p = b[i] / 1E5;
		int D = i - a[i] + 1;
		long double cur = i + 1 + D * (1 - p) / p;
		ans = min(ans , cur);
	}
	cout << ans << "\n";
}
signed main()
{
	ios::sync_with_stdio(false);
	cin.tie(0);
	cout << fixed << setprecision(12);
	int t; cin >> t;
	for (int i = 1; i <= t; i++)work(i);
}
```

